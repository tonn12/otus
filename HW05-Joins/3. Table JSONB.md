1. Создаем таблицу на основе tickets + flights + airports + aircrafts
CREATE TABLE tickets_jsonb AS
SELECT
    t.ticket_no,
    jsonb_build_object(
        'passenger', jsonb_build_object(
            'name', t.passenger_name,
            'id', t.passenger_id,
            'contact', t.contact_data
        ),
        'booking_ref', t.book_ref,
        'flight', jsonb_build_object(
            'flight_no', f.flight_no,
            'departure', f.scheduled_departure,
            'arrival', f.scheduled_arrival,
            'status', f.status,
            'aircraft_code', f.aircraft_code,
            'aircraft_model', ad.model,
            'range_km', ad.range,
            'from', adp.airport_name,
            'to', aar.airport_name
        )
    ) AS data
FROM tickets t
JOIN ticket_flights tf ON t.ticket_no = tf.ticket_no
JOIN flights f ON tf.flight_id = f.flight_id
JOIN aircrafts_data ad ON f.aircraft_code = ad.aircraft_code
JOIN airports_data adp ON f.departure_airport = adp.airport_code
JOIN airports_data aar ON f.arrival_airport = aar.airport_code;

2. Выполним JSONB-запрос на поиск пассажиров летящих на самолёте с дальностью больше 10000 км
SELECT * FROM tickets_jsonb
WHERE (data -> 'flight' ->> 'range_km')::int > 10000;